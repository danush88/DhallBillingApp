<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Page 1: Manage Stock</title>
  <link rel="stylesheet" href="style.css">
  <style>
    input {
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 300px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f8f8f8;
    }
    button {
      margin: 4px;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .add-btn { background: green; color: white; }
    .reduce-btn { background: orange; color: white; }
    .delete-btn { background: red; color: white; }
    .update-btn { background: #007bff; color: white; }
  </style>
</head>
<body>

  <nav>
    <a href="page1_stock.html">Stock</a>
    <a href="page2_create_bill.html">Create Bill</a>
    <a href="page3_final_bill.html">Final Bill</a>
    <a href="page4_view_bills.html">View Bills</a>
  </nav>

  <h2>üì¶ Stock Management</h2>

  <h3>Add or Update Stock</h3>
  <input type="text" id="itemName" placeholder="Item name">
  <input type="number" id="itemQty" placeholder="Quantity (kg)">
  <input type="number" id="itemPrice" placeholder="Price per kg (‚Çπ)">
  <button onclick="addOrUpdateStock()">‚ûï Add / Update</button>

  <h3>üìã Current Stock</h3>
  <table id="stockTable">
    <thead>
      <tr><th>Item</th><th>Qty (kg)</th><th>Price (‚Çπ/kg)</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadStock() {
      return JSON.parse(localStorage.getItem("stock")) || [];
    }

    function saveStock(stock) {
      localStorage.setItem("stock", JSON.stringify(stock));
    }

    function renderStock() {
      const stock = loadStock();
      const tbody = document.querySelector("#stockTable tbody");
      tbody.innerHTML = "";

      stock.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>‚Çπ${item.price}</td>
          <td>
            <button class="add-btn" onclick="modifyQty(${index}, 'add')">‚ûï</button>
            <button class="reduce-btn" onclick="modifyQty(${index}, 'reduce')">‚ûñ</button>
            <button class="update-btn" onclick="updatePrice(${index})">üí∞ Update Price</button>
            <button class="delete-btn" onclick="deleteItem(${index})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function addOrUpdateStock() {
      const name = document.getElementById("itemName").value.trim();
      const qty = parseFloat(document.getElementById("itemQty").value);
      const price = parseFloat(document.getElementById("itemPrice").value);

      if (!name || isNaN(qty) || qty <= 0 || isNaN(price) || price <= 0) {
        alert("Enter valid item name, quantity, and price.");
        return;
      }

      const stock = loadStock();
      const existing = stock.find(item => item.name.toLowerCase() === name.toLowerCase());

      if (existing) {
        existing.qty += qty;
        existing.price = price; // Update price on every addition
      } else {
        stock.push({ name, qty, price });
      }

      saveStock(stock);
      document.getElementById("itemName").value = "";
      document.getElementById("itemQty").value = "";
      document.getElementById("itemPrice").value = "";
      renderStock();
    }

    function modifyQty(index, action) {
      const value = parseFloat(prompt(`Enter amount to ${action === 'add' ? 'add' : 'reduce'}:`));
      if (isNaN(value) || value <= 0) return;

      const stock = loadStock();
      if (action === "add") {
        stock[index].qty += value;
      } else {
        stock[index].qty = Math.max(0, stock[index].qty - value);
      }

      saveStock(stock);
      renderStock();
    }

    function updatePrice(index) {
      const value = parseFloat(prompt("Enter new price per kg:"));
      if (isNaN(value) || value <= 0) return;

      const stock = loadStock();
      stock[index].price = value;
      saveStock(stock);
      renderStock();
    }

    function deleteItem(index) {
      if (confirm("Are you sure you want to delete this item?")) {
        const stock = loadStock();
        stock.splice(index, 1);
        saveStock(stock);
        renderStock();
      }
    }

    renderStock();
  </script>
</body>
</html>
